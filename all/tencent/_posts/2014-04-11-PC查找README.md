---
layout: post
title: 2014-04-11-PC查找README.md
---


# QQ FIND

接口人： rehornchen

## Documentation

[CGI Wiki][1]

[Moniter 视图][2]

[本地构建工具][3]

因Mod合图用到的图形库只兼容0.8.9版本的Node，所以赞且下载指定版本的Node:
http://nodejs.org/dist/v0.8.9/node-v0.8.9-x86.msi

* 安装方式：npm install -g modjs
* 安装成功后构建命令：
* ··sh
# dist 对应 Modfile 中定义的 dist 任务队列
mod dist
···

图片压缩服务：
http://www.smushit.com/


测试环境同步：

···sh
# 1 表示同步到 172.23.136.84 测试机
./p 1
···



## 发布流程

先ARS预编译：
http://pub.qplus.oa.com/html/ars_precompile.php

得到类似地址：
/data/sites/cdn.qplus.com/qqfind/js/find.js
/data/sites/cdn.qplus.com/qqfind/index.html

进入ARS发布系统：
http://ars.isd.com/

1.类目选择：发布请求-免测版本发布
2.产品选择：开放平台 模块选择：公共平台 其他如版本号等可任意填写
3.把预编译得到的地址 粘贴到发布内容
4.下一部处理人选择： 测试童鞋的rtx，如alanqing
5.提交后知会测试

## zip包策略
* zip包更新 客户端触发时间：

    1.登陆后一分钟

    2.打开查找发一次

    3.点诊断按钮重发一次

    查找的id为1， 但其实还有一个映射，那就是 111

    截止2014/4/11， 有4个业务会在5.3QQ登陆后1分钟检查是否有zip包更新， 发四次请求

    1-查找

    117-群资料卡

    121-群共享

    157-群AIO通知中心

    5.2QQ登陆后一分钟内检查是否有zip包更新， 发三次请求

    1-查找

    117-群资料卡

    121-群共享

    5.1QQ登陆后一分钟内检查是否有zip包更新，发二次请求

    1-查找

    117-群资料卡

    5.0QQ登陆后一分钟内检查是否有zip包更新，发一次请求

    1-查找

    2.01QQ登陆后一分钟内检查是否有zip包更新，发一次请求  这之后客户端直接从2.0.1 跳到了 5.0

    1-查找

    客户端底层使用的httpdownload 在http error的情况下会去请求重试， 最多重试3次。


## 出过的问题记录

* 4月10日， 下午6:08分， 客户端拉取本地zip包的请求量暴涨，一直维持在2倍左右，zip包的cdn流量暴涨7倍左右。

    后台 客户端拉取zip包cgi的monitor视图地址：[点击](http://monitor.server.com/link/graph/viewid:5751)  id是： 328936

    查看公司各个业务CDN资源的情况： [内网系统cdn系统](hy.oa.com) 进去之后点击 首页-静态加速-即时通信产品部-Qplus桌面 就可以看到我们 pub.idqqimg.com 的出流量等信息， 这个系统的权限可以找 echozheng 申请, leader是：

    前端同一时间点 在 管理后台发布了pc查找的全国版本zip包。


## QQ 查找 HOST

···
# for QQ 查找，找人页，接口人 rehornchen
10.136.149.166 cgi.find.qq.com
172.23.136.84 find.qq.com
172.23.136.84 pub.idqqimg.com
# for 群查找，接口人 amadeusguo
10.166.133.83 qqun.qq.com
172.27.207.88 1.url.cn
172.27.207.88 2.url.cn
172.27.207.88 3.url.cn
# for 找商家
10.130.88.175 im2.b.qq.com
10.133.3.149 cdn.b.qq.com
10.130.88.175 s.b.qq.com
···

## Examples

[1]: http://tapd.oa.com/v3/Qplus/wikis/view/cgiqqfind "cgi wiki"
[2]: http://monitor.server.com/link/graph/viewid:5097 "monitor view"
[3]: https://npmjs.org/package/modjs "mod js"